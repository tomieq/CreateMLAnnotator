<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>CreateML</title>
    <link href="/bootstrap-5.3.1-dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
        <link href="/style.css" rel="stylesheet">
  </head>
  <body>
    <div class="container">
        <div class="row">
            <div class="col col-10">
            <h5 class="tomieqFont float-end mt-3"> AI Tool</h5>
            <h1 class="tomieqFont">CreateML Annotations</h1>
            
            <hr>
            </div>
        </div>
        <div class="row">
            <div class="col col-10">
                [START error]
                <div class="alert alert-danger" role="alert">
                  {error}
                </div>
                [END error]
                {content}
                <div style="position: relative;">
                    <div id="imageContainer">
                        <img src="pic.jpg" id="picture" class="absolute"/>
                        <div class="frame absolute" style="left: 739px; top: 499px; width: 1205px; height: 735px;">
                            <div class="counter">1</div>
                        </div>
                    </div>
                    <div id="formContainer">
                        <form method="post">
                            <div class="counter" style="float: left;">1</div>
                            <input class="form-control-sm" type="text" placeholder="label" />
                            <input type="hidden" name="left" value="739" />
                            <input type="hidden" name="top" value="499" />
                            <input type="hidden" name="width" value="1205" />
                            <input type="hidden" name="height" value="735" />
                            <input type="submit" class="btn btn-sm btn-primary" value="Save"/>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="/jquery-1.11.1.min.js"></script>
    <script src="/bootstrap-5.3.1-dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
    <script>
        var counter = 0
        var width = $("#picture").width()
        var ratio = 800/width
        console.log(ratio)
        var multiplier = 1/ratio;
        var border = undefined;
        $("#picture").width(width*ratio)
        $("#imageContainer .frame").each(function( index ) {
            $(this).width($(this).width()*ratio);
            $(this).height($(this).height()*ratio);
            var top = $(this).css("top").replace("px", "")
            var left = $(this).css("left").replace("px", "")
            
            console.log("left:" + left);
            $(this).css('left', left * ratio + "px");
            $(this).css('top', top * ratio + "px");
          });

        $("#imageContainer").mousemove(function (event) {
            if (border != undefined) {
                var parentOffset = $(this).parent().offset();
                var relX = event.pageX - parentOffset.left;
                var relY = event.pageY - parentOffset.top;
                var x = Math.round((event.pageX - $(this).offset().left));
                var y = Math.round((event.pageY - $(this).offset().top));
                
                border.height(y - border.position().top);
                border.width(x - border.position().left);
            }
        });
        $("#imageContainer").mousedown(function (event) {
            counter++;
            var parentOffset = $(this).parent().offset();
            var relX = event.pageX - parentOffset.left;
            var relY = event.pageY - parentOffset.top;
            var x = Math.round((event.pageX - $(this).offset().left));
            var y = Math.round((event.pageY - $(this).offset().top));
            console.log(x, y);
            border = $("<div/>")
            border.addClass("frame absolute");
            border.css({top: y, left: x});
            $("#imageContainer").append(border)
        });
        $("#imageContainer").mouseup(function (event) {
            var left = Math.round(border.position().left * multiplier);
            var top = Math.round(border.position().top * multiplier);
            var width = Math.round(border.width() * multiplier);
            var height = Math.round(border.height() * multiplier);
            //console.log("captured object on image; left: " + border.position().left + "px; top: " + border.position().top + "px; width: "+ border.width() + "px; height: "+ border.height() + "px;");
            console.log("captured object on image; left: " + left + "px; top: " + top + "px; width: "+ width + "px; height: "+ height + "px;");
            
            var number = $("<div/>")
            number.html(counter);
            number.addClass("counter");
            border.append(number);
            border = undefined;
            makeForm(counter, top, left, width, height)
        });
        
        function makeForm(counter, top, left, width, height) {
            var form = $('<form method="post"/>');
            var index = $("<div/>");
            index.addClass("counter");
            index.css({float: "left"});
            index.html(counter);
            var input = $('<input class="form-control-sm" type="text" placeholder="label">');
            form.append(input);
            var submit = $('<input type="submit" class="btn btn-sm btn-primary" value="Save"/>');
            form.append(submit);
            form.append(index);
            addHiddenInput(form, "top", top);
            addHiddenInput(form, "left", left);
            addHiddenInput(form, "width", width);
            addHiddenInput(form, "height", height);
            $("#formContainer").append(form);
        }
        
        function addHiddenInput(form, name, value) {
            var input = $('<input type="hidden" name="'+name+'" value="'+value+'"/>');
            form.append(input);
        }
    </script>
  </body>
</html>

